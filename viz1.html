---
layout: articles
title: Abilities
---
<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="assets/tab1_ability/tab1_ability.css"/>
<link rel="stylesheet" href="assets/tab1_ability/lib/jquery-ui.css">
<link rel="stylesheet" href="assets/tab1_ability/lib/jquery.dataTables.min.css">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>




<div class="row">
  <div class="col-md-10">
    <h1 style="margin:64px">Ability?</h1>  
  </div>
  <div id="3d_abi"></div>
</div>




<script>
  // Fetch the JSON data and parse it
  fetch('assets/tab1_ability/data/3dplot.json').then(response => response.json())
  .then(data => {
      // Use Plotly.js to create the graph
      Plotly.newPlot('3d_abi', data.data, data.layout);
  });
</script>


<div class="container">

  <div class="flourish-embed" data-src="visualisation/13939565"><script src="https://public.flourish.studio/resources/embed.js"></script></div>
</div>





<div class="row">
  <div class="col-md-10">
    <h1 style="margin:64px">Ability Recommendation</h1>  
  </div>
  <div class="col-md-2">
    <button id="opener" style="display: inline; margin:64px">Tutorial</button>
  </div>
</div>

<div id="dialog" title="Graph tutorial"  class="modal" style="display:none;">
    <div class="modal-content">
    <span class="close">&times;</span>
    <p>
      <b style="color: #E76F51;">Information</b>
      <ul>
        <li>Every pokemon has a "Tier" attribute, among them, the "OU" rank signals the strongest pokemons.</li>
        <li>Here we sort the top abilities by their occurrence in the "OU" pokemons.</li> 
      </ul>    
    </p>
    
    <p>
      <b style="color: #E76F51;">Selection</b>
      <ul>
        <li>Hover on each bar to view the ability name and occurrence count.</li>
        <li>Click on each bar to view detailed information about the ability.</li>
        <li>Toggle the slider to show the top abilities.</li>
      </ul>
    </p>
    
    <p>
      <b style="color: #E76F51;">Graph</b>
      <ul>
        <li>A bar chart showing the occurrence of an ability among the "OU" pokemons.</li>
        <li>Number of abilities shown is adjustable.</li>
      </ul>
    </p>
    


</div>

</div>



<div class="container">

  <div id="bar-chart"></div>

  <div class="slider-container">
    <input type="range" min="1" id="myRange" class="slider" value="1">
    <p>Number of Abilities Displayed: <span id="sliderValue"></span></p>
  </div>
  
  <div id="bar-info" style="margin-top: 20px;"></div>
  
  <div id="tooltip" style="position: absolute; opacity: 0; pointer-events: none; background-color: #E9C46A; color: white; padding: 5px; border-radius: 5px;"></div>

</div>





<script src="assets/tab1_ability/lib/d3.v4.min.js"></script>
<script src="assets/tab1_ability/lib/jquery.min.js"></script>
<script src="assets/tab1_ability/lib/jquery-ui.js"></script>



<script>
  var modal = document.getElementById("dialog");

  document.getElementById("opener").addEventListener("click", function() {
      modal.style.display = "block";
  });
  
  document.getElementsByClassName("close")[0].addEventListener("click", function() {
      modal.style.display = "none";
  });
  
  window.addEventListener("click", function(event) {
      if (event.target == modal) {
          modal.style.display = "none";
      }
  });
  
</script>




  
<script>
  var slider = document.getElementById("myRange");
  var output = document.getElementById("sliderValue");
  var barChart = document.getElementById("bar-chart");
  var isSliderAnimated = false; // Add a flag to track if the slider has been animated

  
  d3.csv('assets/tab1_ability/data/ability_description.csv', function(error, descriptionData) {
    if (error) throw error;

    d3.csv('assets/tab1_ability/data/top_abilities.csv', function(error, data) {
      if (error) throw error;
      
      data.forEach(function(d) {
        d.Count = +d.Count;
      });

      // Update the slider max value based on the data length
      slider.max = data.length;
      slider.value = 1;
      output.innerHTML = slider.value;  // Display the default slider value

      // Update the chart initially
      updateBarChart(data, descriptionData, data.length);

      // Listen to slider changes and update the chart
      slider.oninput = function() {
        output.innerHTML = this.value;
        updateBarChart(data, descriptionData, this.value);
      }

      window.onscroll = function() {
        var rect = barChart.getBoundingClientRect();
        if(rect.top < window.innerHeight && !isSliderAnimated) {
          animateSlider();
          isSliderAnimated = true;
        }
      };

      function animateSlider() {
        var maxVal = slider.max;
        var duration = 2000;  // Duration for the animation
        var start = null;
    
        function step(timestamp) {
          if (!start) start = timestamp;
          var progress = timestamp - start;
          var fraction = Math.min(progress / duration, 1);
          var easedFraction = Math.pow(fraction, 0.5); // Change this function for different easing effects
          slider.value = Math.floor(easedFraction * maxVal) + 1;
          output.innerHTML = slider.value;
          updateBarChart(data, descriptionData, slider.value);
          if (progress < duration) {
            window.requestAnimationFrame(step);
          }
        }
        
        window.requestAnimationFrame(step);
      }


    });
  });

  function updateBarChart(data, descriptionData, maxAbilities) {
    // Remove existing chart if it exists
    d3.select("#bar-chart").select("svg").remove();

    // Slice the data to keep the top abilities based on the slider value
    var slicedData = data.slice(0, maxAbilities);
    
    // Your existing code to render the chart with slicedData
    let margin = {top: 20, right: 20, bottom: 70, left: 40},
        width = 600 - margin.left - margin.right,
        height = 300 - margin.top - margin.bottom;

    let x = d3.scaleBand().range([0, width]).padding(0.1);
    let y = d3.scaleLinear().range([height, 0]);

    let svg = d3.select("#bar-chart").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
      .append("g")
        .attr("transform", 
              "translate(" + margin.left + "," + margin.top + ")");

    x.domain(slicedData.map(d => d.Ability));
    y.domain([0, d3.max(slicedData, d => d.Count)]);

    svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x))
      .selectAll("text")
        .attr("transform", "rotate(-45)")
        .style("text-anchor", "end");

    svg.append("g")
        .call(d3.axisLeft(y))
        .append("text")
        .attr("fill", "#000")
        .attr("transform", "rotate(-90)")
        .attr("y", -margin.left)
        .attr("x", -height/2)
        .attr("dy", "1em")
        .attr("text-anchor", "middle")
        .text("Occurance Count");

    svg.selectAll(".bar")
        .data(slicedData)
      .enter().append("rect")
        .attr("class", "bar")
        .attr("x", d => x(d.Ability))
        .attr("width", x.bandwidth())
        .attr("y", d => y(d.Count))
        .attr("height", d => height - y(d.Count))
        .attr("fill", "#E9C46A")
        
        .on('click', function(d, i) {
          // 找到对应的描述
          let matchedDescription = descriptionData.find(desc => desc.Ability === d.Ability);
          let abilityDescription = matchedDescription ? matchedDescription.description : 'Description not found';
      
          d3.select('#bar-info')
              .html(`
                  <p style="display: inline-block;"><span style="color:#E9C46A;">${d.Ability}</span>: ${abilityDescription}</p>
              `);
      })
        
        .on("mouseover", function(d) {
          let html = `Ability: ${d.Ability}<br/>Count: ${d.Count}`;
          d3.select("#tooltip")
              .style("opacity", 1)
              .html(html)
              .style('left', (event.pageX + 10) + 'px') 
              .style('top', (event.pageY + 10) + 'px');
      })
      .on("mouseout", function(d) {
          d3.select("#tooltip")
              .style("opacity", 0);
      });
  }
</script>


